var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{h(o.next(t))}catch(e){r(e)}}function a(t){try{h(o["throw"](t))}catch(e){r(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Game=function(t){function e(){var e=t.call(this)||this;return e.wofsArray=[],e.wofsPool=[],e.stonesPool=[],e.scoreCount=0,e.skinName="gameComponent",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gameInit()},e.prototype.gameInit=function(){for(var t=this,e=0;10>e;e++){var i=new Wof(0,this);this.wofsPool.push(i);var o=new Stone(RES.getRes("stone_png"));this.stonesPool.push(o)}this.pig=new Pig,this.pig.x=964,this.pig.y=77,this.pig.setGameControl(this),this.collisionGroup.addChild(this.pig),this.pigSkill=new PigSkill(this.pig),this.pigSkill.x=1020,this.pigSkill.y=90,this.collisionGroup.addChild(this.pigSkill),this.timer=new egret.Timer(2e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.createWof,this),this.timer.start();var n=new Button;n.Init("start_png","",function(e){t.scoreGroup.visible=!1,t.reStart()},2),n.x=300,n.y=300,n.scaleX=n.scaleY=.5,this.scoreGroup.addChild(n)},e.prototype.createWof=function(t){var e;e=this.wofsPool.length>0?this.wofsPool.pop():new Wof(0,this),e.setInit(),this.wofsArray.push(e),this.collisionGroup.addChild(e)},e.prototype.updateString=function(){var t=this.pig.y-this.pigString.y;this.pigString.height=t+10},e.prototype.updateScore=function(){this.score.text="杀了"+this.scoreCount+"匹狼"},e.prototype.gameOVer=function(){this.scoreGroup.visible=!0},e.prototype.reStart=function(){this.parent.addChild(new e),this.parent.removeChild(this)},e}(eui.Component);__reflect(Game.prototype,"Game");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?o(n):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,this.loadTheme()];case 2:return o.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return o.sent(),this.stage.removeChild(t),GameConst.stage=this.stage,e=new Wellcome,this.stage.addChild(e),[3,5];case 4:return i=o.sent(),console.error(i),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function n(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(o,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameData=function(){function t(){}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t}();__reflect(GameData.prototype,"GameData");var Arrow=function(t){function e(e,i){var o=t.call(this)||this;return o.type=0,o.speed=.6,o.skinName="arrow",o.pig=i,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAdd,o),o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onRemove,o),o.anchorOffsetY=100,o.setType(e),o}return __extends(e,t),e.prototype.setType=function(t){this.type!=t&&(this.type=t,0==this.type?(this.boom.visible=!1,this.stone.visible=!1,this.arrow.visible=!0):1==this.type?(this.boom.visible=!1,this.stone.visible=!0,this.arrow.visible=!0):2==this.type&&(this.boom.visible=!0,this.stone.visible=!1,this.arrow.visible=!1))},e.prototype.onAdd=function(t){egret.startTick(this.startTick,this)},e.prototype.onRemove=function(t){egret.stopTick(this.startTick,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,i){this.posStart=t,this.posTemple=e,this.posEnd=i},e.prototype.fire=function(){var t,e,i,o,n=this;0==this.type?(t=-300,i=this.x-t,e=i/20+this.y,o=180*-Math.atan(.05)/3.14):1==this.type&&(t=200,i=667,e=750,o=-45);var r,s,a,h=new egret.Point(this.x,this.y),l=new egret.Point(t,e);0==this.type?(r=(h.x+l.x)/2,s=(h.y+l.y)/2-100,a=1):1==this.type&&(r=100,s=200,a=1);var p=new egret.Point(r,s);this.setPos(h,p,l);var c=i/this.speed;2==this.type?egret.Tween.get(this).to({x:-300},1e4).call(function(){n.parent.removeChild(n),n.setType(0),n.pig.arrowBag.push(n)}):egret.Tween.get(this).to({x:-300,y:e,rotation:o,factor:a},c).call(function(){n.rotation=0,n.parent.removeChild(n),n.setType(0),n.pig.arrowBag.push(n)})},e.prototype.startTick=function(t){return this.hitWofTest(),!1},e.prototype.hitWofTest=function(){var t=this;this.pig.gameControl.wofsArray.forEach(function(e){var i=e;if(0==t.type){var o=i.ballute.hitTestPoint(t.x,t.y),n=i.fly.hitTestPoint(t.x,t.y);o&&i.beHited(),n&&t.hitWofBody()}else(1==t.type||2==t.type)&&i.hitTestPoint(t.x,t.y)&&i.beHited()})},e.prototype.hitWofBody=function(){var t=this;egret.stopTick(this.startTick,this),egret.Tween.removeTweens(this);var e=this.pig.arrowContainer.indexOf(this);this.pig.arrowContainer.splice(e,1),egret.Tween.get(this).to({x:this.x+5,y:this.y+20,rotation:-30},30).to({x:this.x+30,y:1e3,alpha:0,rotation:-90},1e3).call(function(){t.alpha=1,t.rotation=0,t.parent.removeChild(t),t.setType(0),t.pig.arrowBag.push(t)})},e}(eui.Component);__reflect(Arrow.prototype,"Arrow");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GameConst=function(){function t(){}return t.isWeiXin=function(){var t=navigator.userAgent.toString(),e=t.match(/MicroMessenger/i);return"MicroMessenger"==e?!0:!1},t}();__reflect(GameConst.prototype,"GameConst");var Pig=function(t){function e(){var e=t.call(this)||this;return e.arrowContainer=[],e.arrowBag=[],e.maxArrow=5,e.skillType=0,e.skinName="pig",e}return __extends(e,t),e.prototype.setGameControl=function(t){this.gameControl=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this);for(var t=0;5>t;){if(this.parent){var e=new Arrow(0,this);this.arrowBag.push(e)}t++}},e.prototype.setSkill=function(t){this.skillType=t},e.prototype.touchMove=function(t){this.y=t.stageY-this.height/2,this.y>460?this.y=460:this.y<80&&(this.y=80),this.gameControl.updateString()},e.prototype.attack=function(){if(this.parent&&this.arrowBag.length>0){var t=this.arrowBag.pop();t.setType(this.skillType),this.parent.addChild(t),t.x=this.x,t.y=this.y+120,t.fire(),this.arrowContainer.push(t),this.skillType=0}},e.prototype.getArrows=function(){return this.arrowContainer},e.prototype.beHited=function(){var t=this;GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this),egret.Tween.get(this).to({y:550,alpha:1,rotation:30},1e3).call(function(){t.gameControl.gameOVer()})},e}(eui.Component);__reflect(Pig.prototype,"Pig");var PigSkill=function(t){function e(e){var i=t.call(this)||this;return i.skillOpen=!1,i.currentSkill=0,i.skinName="pigSkill",i.pig=e,i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setInterval(function(){e.createSkill()},5e3)},e.prototype.createSkill=function(){this.skillOpen=!0,this.stone.visible=!0;var t=Math.round(Math.random()+1);1==t?(this.stone.visible=!0,this.boom.visible=!1):(this.boom.visible=!0,this.stone.visible=!1),this.currentSkill=t,egret.startTick(this.startTic,this)},e.prototype.startTic=function(t){return this.pig.hitTestPoint(this.x,this.y)&&(egret.stopTick(this.startTic,this),this.pig.setSkill(this.currentSkill),this.boom.visible=!1,this.stone.visible=!1),!1},e}(eui.Component);__reflect(PigSkill.prototype,"PigSkill");var Stone=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,i,o){this.posStart=t,this.posTemple=e,this.posEnd=i,this.gameControl=o},e.prototype["throw"]=function(){var t=this;egret.Tween.get(this).to({factor:2},3e3).call(function(){egret.Tween.removeTweens(t),t.parent.removeChild(t),egret.stopTick(t.start,t),t.gameControl.stonesPool.push(t)}),egret.startTick(this.start,this)},e.prototype.start=function(t){return this.gameControl.pig.hitTestPoint(this.x,this.y)&&this.gameControl.pig.beHited(),!1},e}(egret.Bitmap);__reflect(Stone.prototype,"Stone");var Wellcome=function(t){function e(){var e=t.call(this)||this;return e.login=!1,e.skinName="wellcome",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.login=!0;var i=new Button;i.Init("start_png","",function(t){if(e.login){var i=new Game;e.parent.addChild(i),e.parent.removeChild(e)}},"start"),i.x=668,i.y=400,this.addChild(i)},e.prototype.loadIM=function(){var t=new egret.ImageLoader;t.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),t.load(GameData.getInstance().user.avatarUrl)},e.prototype.loadComplete=function(t){var e=new egret.Texture;e._setBitmapData(t.currentTarget.data);var i=new egret.Bitmap(e);this.addChild(i)},e}(eui.Component);__reflect(Wellcome.prototype,"Wellcome");var Wof=function(t){function e(e,i){var o=t.call(this)||this;return o.walkSpeed=120,o.flySpeed=60,o.beKilled=!1,o.skinName="wof",o.type=e,o.gameControl=i,o}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setWofState(0),this.x=-100,this.y=-60},e.prototype.setInit=function(){this.setWofState(0),this.x=-100,this.y=-60,this.alpha=1,this.beKilled=!1,this.autoMove()},e.prototype.setWofState=function(t){t!=this.stage&&(this.state=t,0==this.state?(this.walk.visible=!0,this.flyGroup.visible=!1):1==this.state&&(this.walk.visible=!1,this.flyGroup.visible=!0))},e.prototype.autoMove=function(){var t=this;egret.Tween.removeTweens(this);var e=Math.floor(600*Math.random())+128,i=1e3*e/this.walkSpeed,o=65e4/this.flySpeed,n=1e3*(1400-e)/this.walkSpeed;egret.Tween.get(this).to({x:e},i).call(function(){t.setWofState(1);var e=Math.round(10*Math.random());e>6&&t.throwStone(o)}).to({y:590},o).call(function(){t.setWofState(0)}).to({x:1400},n).call(function(){var e=t.gameControl.wofsArray.indexOf(t);t.gameControl.wofsArray.splice(e,1),t.parent&&(t.parent.removeChild(t),t.gameControl.wofsPool.push(t))})},e.prototype.beHited=function(){var t=this;egret.Tween.removeTweens(this),this.beKilled=!0,this.setWofState(0);var e=this.gameControl.wofsArray.indexOf(this);this.gameControl.wofsArray.splice(e,1),egret.Tween.get(this).to({y:1e3,alpha:0},3e3).call(function(){t.gameControl.wofsPool.push(t),t.parent.removeChild(t)}),this.gameControl.scoreCount++,this.gameControl.updateScore()},e.prototype.throwStone=function(t){var e=this,i=Math.random()*t;setTimeout(function(){if(!e.beKilled&&e.gameControl.stonesPool.length>0){e.stone=e.gameControl.stonesPool.pop();var t=new egret.Point(e.x,e.y+150),i=new egret.Point(e.gameControl.pig.x+85,e.gameControl.pig.y+85),o=(t.x+i.x)/2,n=(t.y+i.y)/2-100,r=new egret.Point(o,n);e.stone.setPos(t,r,i,e.gameControl),e.parent.addChild(e.stone),e.stone["throw"]()}},i)},e}(eui.Component);__reflect(Wof.prototype,"Wof");var Button=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.Init=function(t,e,i,o){this._callback=i,this._thisObj=o,this._bit=new egret.Bitmap(RES.getRes(t)),this._bit.scale9Grid=new egret.Rectangle(16,21,25,25),this.addChild(this._bit),this._bit.x=-this._bit.width/2,this._bit.y=-this._bit.height/2,this._txt=new egret.TextField,this._txt.text=e,this._txt.textColor=12189596,this._txt.x=-this._txt.textWidth/2,this._txt.y=-this._txt.textHeight/2,this.addChild(this._txt),this.touchChildren=!1,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this)},e.prototype.onTab=function(t){this._callback&&this._callback.call(this._thisObj)},e.prototype.onBegin=function(t){this.scaleX=this.scaleY=.9},e.prototype.onEnd=function(t){this.onCancle()},e.prototype.onCancle=function(t){void 0===t&&(t=null),this.scaleX=this.scaleY=1},e}(egret.Sprite);__reflect(Button.prototype,"Button");