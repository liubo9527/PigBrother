var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{h(i.next(t))}catch(e){o(e)}}function a(t){try{h(i["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,o=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Pig=function(t){function e(){var e=t.call(this)||this;return e.arrowContainer=[],e.arrowBag=[],e.maxArrow=5,e.skillType=0,e.alive=!0,e.skinName="pig",e}return __extends(e,t),e.prototype.setGameControl=function(t){this.gameControl=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this);for(var t=0;5>t;){if(this.parent){var e=new Arrow(0,this);this.arrowBag.push(e)}t++}},e.prototype.setSkill=function(t){this.skillType=t},e.prototype.touchMove=function(t){this.y=t.stageY-this.height/2,this.y>460?this.y=460:this.y<80&&(this.y=80),this.gameControl.updateString()},e.prototype.attack=function(){if(this.parent&&this.arrowBag.length>0){var t=this.arrowBag.pop();t.setType(this.skillType),this.parent.addChild(t),t.x=this.x+100,t.y=this.y+120,t.fire(),this.arrowContainer.push(t),this.skillType=0}},e.prototype.getArrows=function(){return this.arrowContainer},e.prototype.beHited=function(){var t=this;if(this.alive){this.alive=!1,GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this);var e=new egret.Bitmap(RES.getRes("pigFall_png")),n=this.pig.localToGlobal(this.pig.x,this.pig.y);e.x=n.x-50,e.y=n.y,this.parent.addChild(e),this.pig.visible=!1,egret.Tween.get(e).to({y:550,x:this.x-100},1e3).call(function(){t.gameControl.gameOVer()})}},e}(eui.Component);__reflect(Pig.prototype,"Pig");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),GameConst.stage=this.stage,e=new Wellcome,this.stage.addChild(e),[3,5];case 4:return n=i.sent(),console.error(n),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function r(t){e.call(i,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(i))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameData=function(){function t(){}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t}();__reflect(GameData.prototype,"GameData");var Arrow=function(t){function e(e,n){var i=t.call(this)||this;return i.type=0,i.speed=1,i.skinName="arrow",i.pig=n,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAdd,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemove,i),i.anchorOffsetY=100,i.setType(e),i}return __extends(e,t),e.prototype.setType=function(t){this.type!=t&&(this.type=t,0==this.type?(this.boom.visible=!1,this.bone.visible=!1,this.arrow.visible=!0):1==this.type?(this.boom.visible=!1,this.bone.visible=!0,this.arrow.visible=!1):2==this.type&&(this.boom.visible=!0,this.bone.visible=!1,this.arrow.visible=!1))},e.prototype.onAdd=function(t){egret.startTick(this.startTick,this)},e.prototype.onRemove=function(t){egret.stopTick(this.startTick,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,n){this.posStart=t,this.posTemple=e,this.posEnd=n},e.prototype.fire=function(){var t,e,n,i,r=this;0==this.type?(t=-300,n=this.x-t,e=n/20+this.y,i=180*-Math.atan(.05)/3.14):1==this.type&&(t=200,n=1600,e=750,i=-45);var o,s,a,h=new egret.Point(this.x,this.y),l=new egret.Point(t,e);0==this.type?(o=(h.x+l.x)/2,s=(h.y+l.y)/2-100,a=1):1==this.type&&(o=100,s=200,a=1);var c=new egret.Point(o,s);this.setPos(h,c,l);var u=n/this.speed;2==this.type?egret.Tween.get(this).to({x:-300},1e4).call(function(){r.parent.removeChild(r),r.setType(0),r.pig.arrowBag.push(r)}):egret.Tween.get(this).to({x:-300,y:e,rotation:i,factor:a},u).call(function(){r.rotation=0,r.parent.removeChild(r),r.setType(0),r.pig.arrowBag.push(r)})},e.prototype.startTick=function(t){return this.hitWofTest(),!1},e.prototype.hitWofTest=function(){var t=this;this.pig.gameControl.wofsArray.forEach(function(e){var n=e;if(0==t.type){var i=n.ballute.hitTestPoint(t.x,t.y),r=n.fly.hitTestPoint(t.x,t.y);i&&n.beHited(),r&&t.hitWofBody()}else 1==t.type?GameConst.crossTest(n,t.arrow)&&n.beHited():2==t.type&&GameConst.crossTest(n,t)&&n.beHited()})},e.prototype.hitWofBody=function(){var t=this;egret.stopTick(this.startTick,this),egret.Tween.removeTweens(this);var e=this.pig.arrowContainer.indexOf(this);this.pig.arrowContainer.splice(e,1),egret.Tween.get(this).to({x:this.x+5,y:this.y+20,rotation:-30},30).to({x:this.x+30,y:1e3,alpha:0,rotation:-90},1e3).call(function(){t.alpha=1,t.rotation=0,t.parent.removeChild(t),t.setType(0),t.pig.arrowBag.push(t)})},e}(eui.Component);__reflect(Arrow.prototype,"Arrow");var Game=function(t){function e(){var e=t.call(this)||this;return e.wofsArray=[],e.wofsPool=[],e.stonesPool=[],e.scoreCount=0,e.skinName="gameComponent",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gameInit()},e.prototype.gameInit=function(){for(var t=this,e=0;10>e;e++){var n=new Wof(0,this);this.wofsPool.push(n);var i=new Stone(RES.getRes("stone_png"));this.stonesPool.push(i)}this.pig=new Pig,this.pig.x=964,this.pig.y=77,this.pig.setGameControl(this),this.collisionGroup.addChild(this.pig),this.pigSkill=new PigSkill(this.pig),this.pigSkill.x=1020,this.pigSkill.y=90,this.collisionGroup.addChild(this.pigSkill),this.timer=new egret.Timer(2e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.createWof,this),this.timer.start();var r=new Button;r.Init("start_png","",function(e){t.scoreGroup.visible=!1,t.reStart()},2),r.x=300,r.y=300,r.scaleX=r.scaleY=.5,this.scoreGroup.addChild(r)},e.prototype.createWof=function(t){var e;e=this.wofsPool.length>0?this.wofsPool.pop():new Wof(0,this),e.setInit(),this.wofsArray.push(e),this.collisionGroup.addChild(e)},e.prototype.updateString=function(){var t=this.pig.y-this.pigString.y;this.pigString.height=t+10},e.prototype.updateScore=function(){this.score.text="杀了"+this.scoreCount+"匹狼"},e.prototype.gameOVer=function(){this.scoreGroup.visible=!0},e.prototype.reStart=function(){this.parent.addChild(new e),this.parent.removeChild(this)},e}(eui.Component);__reflect(Game.prototype,"Game");var GameConst=function(){function t(){}return t.isWeiXin=function(){var t=navigator.userAgent.toString(),e=t.match(/MicroMessenger/i);return"MicroMessenger"==e?!0:!1},t.crossTest=function(e,n){return this.rect1||(this.rect1=new egret.Rectangle),this.rect2||(this.rect2=new egret.Rectangle),e.getTransformedBounds(t.stage,this.rect1),n.getTransformedBounds(t.stage,this.rect2),this.rect1.intersects(this.rect2)?!0:!1},t}();__reflect(GameConst.prototype,"GameConst");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var PigSkill=function(t){function e(e){var n=t.call(this)||this;return n.skillOpen=!1,n.currentSkill=0,n.skinName="pigSkill",n.pig=e,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setInterval(function(){e.createSkill()},5e3)},e.prototype.createSkill=function(){this.skillOpen=!0,this.bone.visible=!0;var t=Math.round(Math.random()+1);1==t?(this.bone.visible=!0,this.boom.visible=!1):(this.boom.visible=!0,this.bone.visible=!1),this.currentSkill=t,egret.startTick(this.startTic,this)},e.prototype.startTic=function(t){return this.pig.hitTestPoint(this.x,this.y)&&(egret.stopTick(this.startTic,this),this.pig.setSkill(this.currentSkill),this.boom.visible=!1,this.bone.visible=!1),!1},e}(eui.Component);__reflect(PigSkill.prototype,"PigSkill");var Stone=function(t){function e(e){var n=t.call(this,e)||this;return n.active=!0,n}return __extends(e,t),Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,n,i){this.posStart=t,this.posTemple=e,this.posEnd=n,this.gameControl=i},e.prototype["throw"]=function(){var t=this;egret.Tween.get(this).to({factor:2},3e3).call(function(){egret.Tween.removeTweens(t),t.parent.removeChild(t),egret.stopTick(t.start,t),t.gameControl.stonesPool.push(t)}),egret.startTick(this.start,this)},e.prototype.hitTest=function(){var t=this;(GameConst.crossTest(this.gameControl.pig.pigTop,this)||GameConst.crossTest(this.gameControl.pig.pigBottom,this))&&this.active?(egret.Tween.removeTweens(this),this.active=!1,egret.Tween.get(this).to({x:this.x-50,y:this.y+1e3},2e3).call(function(){t.parent.removeChild(t),egret.stopTick(t.start,t),t.active=!0,t.gameControl.stonesPool.push(t)})):GameConst.crossTest(this.gameControl.pig.pig,this)&&this.active&&(this.active=!1,this.gameControl.pig.beHited())},e.prototype.start=function(t){return this.hitTest(),!1},e}(egret.Bitmap);__reflect(Stone.prototype,"Stone");var Wellcome=function(t){function e(){var e=t.call(this)||this;return e.login=!1,e.skinName="wellcome",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.login=!0;var n=new Button;n.Init("start_png","",function(t){if(e.login){var n=new Game;e.parent.addChild(n),e.parent.removeChild(e)}},"start"),n.x=668,n.y=400,this.addChild(n)},e.prototype.loadIM=function(){var t=new egret.ImageLoader;t.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),t.load(GameData.getInstance().user.avatarUrl)},e.prototype.loadComplete=function(t){var e=new egret.Texture;e._setBitmapData(t.currentTarget.data);var n=new egret.Bitmap(e);this.addChild(n)},e}(eui.Component);__reflect(Wellcome.prototype,"Wellcome");var Wof=function(t){function e(e,n){var i=t.call(this)||this;return i.walkSpeed=120,i.flySpeed=60,i.beKilled=!1,i.skinName="wof",i.type=e,i.gameControl=n,i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setWofState(0),this.x=-100,this.y=-60},e.prototype.setInit=function(){this.setWofState(0),this.x=-100,this.y=-60,this.alpha=1,this.beKilled=!1,this.fly.visible=!0,this.fall.visible=!1,this.scaleY=1;var t=Math.round(10*Math.random());3>=t?(this.type=1,this.ballute=this.ballute1):t>=7?(this.type=2,this.ballute=this.ballute2):(this.type=0,this.ballute=this.ballute0),this.autoMove()},e.prototype.setWofState=function(t){t!=this.stage&&(this.state=t,0==this.state?(this.walk.visible=!0,this.flyGroup.visible=!1):1==this.state&&(this.walk.visible=!1,this.flyGroup.visible=!0,this.ballute0.visible=!1,this.ballute1.visible=!1,this.ballute2.visible=!1,this.ballute.visible=!0))},e.prototype.autoMove=function(){var t=this;egret.Tween.removeTweens(this);var e=Math.floor(600*Math.random())+128,n=1e3*e/this.walkSpeed,i=65e4/this.flySpeed,r=1e3*(1400-e)/this.walkSpeed;egret.Tween.get(this).to({x:e},n).call(function(){if(t.setWofState(1),0!=t.type){var e=Math.random()*i;t.timeoutTimer=setTimeout(function(){t.throwStone()},e)}}).to({y:590},i).call(function(){2==t.type&&clearInterval(t.IntervalTimer),t.setWofState(0)}).to({x:1400},r).call(function(){var e=t.gameControl.wofsArray.indexOf(t);t.gameControl.wofsArray.splice(e,1),t.parent&&(t.parent.removeChild(t),t.gameControl.wofsPool.push(t))})},e.prototype.beHited=function(){var t=this;egret.Tween.removeTweens(this),clearInterval(this.IntervalTimer),clearTimeout(this.timeoutTimer),this.beKilled=!0;var e=this.gameControl.wofsArray.indexOf(this);this.gameControl.wofsArray.splice(e,1),this.ballute.visible=!1,this.fly.visible=!1,this.fall.visible=!0,egret.Tween.get(this).to({scaleY:1},500).to({scaleY:-1,y:this.y+200},0).to({y:1e3,alpha:0},3e3).call(function(){t.gameControl.wofsPool.push(t),t.parent.removeChild(t)}),this.gameControl.scoreCount++,this.gameControl.updateScore()},e.prototype.throwStone=function(){var t=this;1==this.type?this["throw"]():2==this.type&&(this.IntervalTimer=setInterval(function(){t["throw"]()},500))},e.prototype["throw"]=function(){if(!this.beKilled&&this.gameControl.stonesPool.length>0){this.stone=this.gameControl.stonesPool.pop();var t=new egret.Point(this.x,this.y+150),e=200*Math.random()-15,n=new egret.Point(this.gameControl.pig.x+85,this.gameControl.pig.y+e),i=(t.x+n.x)/2,r=(t.y+n.y)/2-100,o=new egret.Point(i,r);this.stone.setPos(t,o,n,this.gameControl),this.parent.addChild(this.stone),this.stone["throw"]()}},e}(eui.Component);__reflect(Wof.prototype,"Wof");var Button=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.Init=function(t,e,n,i){this._callback=n,this._thisObj=i,this._bit=new egret.Bitmap(RES.getRes(t)),this._bit.scale9Grid=new egret.Rectangle(16,21,25,25),this.addChild(this._bit),this._bit.x=-this._bit.width/2,this._bit.y=-this._bit.height/2,this._txt=new egret.TextField,this._txt.text=e,this._txt.textColor=12189596,this._txt.x=-this._txt.textWidth/2,this._txt.y=-this._txt.textHeight/2,this.addChild(this._txt),this.touchChildren=!1,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this)},e.prototype.onTab=function(t){this._callback&&this._callback.call(this._thisObj)},e.prototype.onBegin=function(t){this.scaleX=this.scaleY=.9},e.prototype.onEnd=function(t){this.onCancle()},e.prototype.onCancle=function(t){void 0===t&&(t=null),this.scaleX=this.scaleY=1},e}(egret.Sprite);__reflect(Button.prototype,"Button");var SAT;!function(t){function e(t){return t.length<=3?!1:i(t,0)>=0}function n(t){var e=[];return c(t)||u(t),o(t,e,0),e}function i(t,e){if(void 0===e&&(e=0),t.length<=3)return-1;for(var n=0,i=t.length+e,r=e;i>r;r++)if(n=h(t[(r+t.length)%t.length],t[(r-1+t.length)%t.length],t[(r+1+t.length)%t.length]),n==w.ANTICLOCKWISE)return r%t.length;return-1}function r(t,e){if(void 0===e&&(e=0),t.length<=3)return[];for(var n=[],i=0,r=t.length+e,o=e;r>o;o++)i=h(t[(o+t.length)%t.length],t[(o-1+t.length)%t.length],t[(o+1+t.length)%t.length]),i==w.ANTICLOCKWISE&&n.push(o%t.length);return n}function o(t,e,n){if(t.length<=3)return void e.push(t);var r=i(t,n);if(n=r+1,0>r)return void e.push(t);var h=new _;if(a(t,r,h)){var l=[],c=[];return s(t,r,h,l,c),o(l,e,n),void o(c,e,n)}e.push(t)}function s(t,e,n,i,r){if(0>e||e>=t.length)return!1;if(n.intersectionindex<0||n.intersectionindex>=t.length)return!1;var o=0;if(e<=n.intersectionindex+1)for(o=n.intersectionindex;o<=e+t.length;o++){var s=t[o%t.length];i.push(s)}else for(o=n.intersectionindex;e>=o;o++){var a=t[o];i.push(a)}if(e<=n.intersectionindex)for(o=e;o<=n.intersectionindex;o++){var h=t[o];r.push(h)}else for(o=e;o<=n.intersectionindex+t.length;o++){var l=t[o%t.length];r.push(l)}return t[n.intersectionindex].x!=n.intersectionpoint.x&&t[n.intersectionindex].y!=n.intersectionpoint.y&&(i.push(n.intersectionpoint),r.push(n.intersectionpoint)),!0}function a(t,e,n){if(t.length<=3)return!1;var i,r;i=e>0?e-1:t.length-1,r=e<t.length-1?e+1:0;var o=0,s=0,a=[],l=[],c=[],u=[],p=[],f=[],d=[],v=[],w=0;w=i>=r?i:i+t.length;for(var _=0,T=r;w>=T;T++)_=T%t.length,o=h(t[e],t[i],t[_]),s=h(t[e],t[r],t[_]),0>o&&s>0?a.push(_):o>=0&&s>=0?l.push(_):0>=o&&0>s?c.push(_):o>0&&0>s&&u.push(_);if(g(t,e,a,p),f=l.concat(),v=u.concat(),g(t,e,c,d),p.length>0){var C=[],E=[];return y(t,p,C,E),E.length>0?n.intersectionindex=x(t,e,E):n.intersectionindex=x(t,e,C),n.intersectionindex<0||n.intersectionindex>=t.length?!1:(n.intersectionpoint=t[n.intersectionindex],!0)}if(f.length<1||d.length<1)return console.warn("BC分区为空错误"),!1;var b=0,S=0,P=0;b=e,S=f[f.length-1],P=d[0];var I=new egret.Point(t[P].x-t[S].x,t[P].y-t[S].y),A=new egret.Point(t[e].x-t[i].x,t[e].y-t[i].y),k=new egret.Point(t[e].x-t[r].x,t[e].y-t[r].y),R=new egret.Point((A.x+k.x)/2,(A.y+k.y)/2),O=new egret.Point(0,0);return 1!=m(t[e],R,t[S],I,O)?!1:(n.intersectionindex=S,n.intersectionpoint=O,!0)}function h(t,e,n){var i=(t.x-e.x)*(n.y-t.y)-(n.x-t.x)*(t.y-e.y);return i>0?w.ANTICLOCKWISE:0>i?w.CLOCKWISE:w.INALINE}function l(t,e){return t.length<=2?w.INALINE:h(t[e%t.length],t[(e+t.length-1)%t.length],t[(e+1)%t.length])}function c(t){if(t.length<=2)return!0;for(var e=0,n=0,i=0,r=0,o=1;o<t.length;o++)i=(o+1)%t.length,r=(o+2)%t.length,e=(t[i].x-t[o].x)*(t[r].y-t[i].y),e-=(t[i].y-t[o].y)*(t[r].x-t[i].x),0>e?n--:e>0&&n++;return 0>=n}function u(t){for(var e=t.length,n=-1;++n<e/2;){var i,r;i=t[n],r=t[e-n-1],t[n]=r,t[e-n-1]=i}}function p(t,e,n,i){var r=new egret.Point(n.x-t.x,n.y-t.y),o=e.x*i.y-e.y*i.x,s=o*o,a=e.x*e.x+e.y*e.y,h=i.x*i.x+i.y*i.y,l=.01;if(s>l*a*h){var c=(r.x*i.y-r.y*i.x)/o;if(0>c||c>1)return 0;var u=(r.x*e.y-r.y*e.x)/o;return 0>u||u>1?0:1}return 0}function f(t,e,n){for(var i=0,r=0;r<t.length;r++)if(i=r>=t.length-1?0:r+1,r!=e&&r!=n&&i!=e&&i!=n&&p(t[e],t[n],t[r],t[i]))return!1;return!0}function g(t,e,n,i){for(var r=-1;++r<n.length;)f(t,e,n[r])&&i.push(n[r])}function y(t,e,n,i){for(var r=-1;++r<e.length;)l(t,e[r])?n.push(e[r]):i.push(e[r])}function d(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);0>=e||(t.x=t.x/e,t.y=t.y/e)}function v(t,e){return t.x*e.x+t.y*e.y}function x(t,e,n){if(n.length<1)return-1;var i,r,o=-1;i=(t.length+e-1)%t.length,r=(t.length+e+1)%t.length;var s=new egret.Point,a=new egret.Point;s.x=t[e].x-t[i].x,s.y=t[e].y-t[i].y,a.x=t[e].x-t[r].x,a.y=t[e].y-t[r].y,d(s),d(a);for(var h=-1,l=-1;++l<n.length;){var c=new egret.Point;c=t[n[l]];var u=new egret.Point;u.x=c.x-t[e].x,u.y=c.y-t[e].y,d(u);var p=Math.abs(v(s,u));p>h&&(o=n[l])}return o}function m(t,e,n,i,r){var o=new egret.Point(n.x-t.x,n.y-t.y),s=e.x*i.y-e.y*i.x,a=s*s,h=e.x*e.x+e.y*e.y,l=i.x*i.x+i.y*i.y,c=.01;if(a>c*h*l){var u=(o.x*i.y-o.y*i.x)/s;if(0>u)return 0;var p=(o.x*e.y-o.y*e.x)/s;if(0>p||p>1)return 0;var f=new egret.Point(e.x*u,e.y*u);return r.x=t.x+f.x,r.y=t.y+f.y,1}return 0}var w;!function(t){t[t.CLOCKWISE=-1]="CLOCKWISE",t[t.INALINE=0]="INALINE",t[t.ANTICLOCKWISE=1]="ANTICLOCKWISE"}(w||(w={}));var _=function(){function t(){this.intersectionindex=-1,this.intersectionpoint=new egret.Point(0,0)}return t}();__reflect(_.prototype,"IntersectionStruct"),t.isConcavePoly=e,t.onSeparateConcavePoly=n,t.getNextConcaveIndex=i,t.getAllConcaveIndex=r}(SAT||(SAT={}));var SAT_SIMPLE;!function(t){function e(t,e){if(t.length<3||e.length<3)return 0;var n=[];n=o(t,n),n=o(e,n);var i,r,h=new egret.Point;for(i=0;i<n.length;i++)if(r=a(t,n[i]),h=a(e,n[i]),!s(r,h))return 0;return 1}function n(t,e){return t.x*e.x+t.y*e.y}function i(t){var e=new egret.Point(t.x,t.y),n=Math.sqrt(e.x*e.x+e.y*e.y);return n?(e.x/=n,e.y/=n,e):e}function r(t){var e=new egret.Point(t.x,t.y),n=e.x;return e.x=e.y,e.y=-n,e}function o(t,e){void 0===e&&(e=[]);var n,o=0,s=!1,a=new egret.Point,h=new egret.Point;for(n=0;n<t.length;n++){for(n>=t.length-1?(h.x=t[0].x-t[n].x,h.y=t[0].y-t[n].y):(h.x=t[n+1].x-t[n].x,h.y=t[n+1].y-t[n].y),a=r(i(h)),a.x<=0&&(0==a.x?a.y<0&&(a.y*=-1):(a.x*=-1,a.y*=-1)),s=!0,o=0;o<e.length;o++)if(e[o].x==a.x&&e[o].y==a.y){s=!1;break}s&&e.push(a)}return e}function s(t,e){return t.x>e.y?0:t.y<e.x?0:((t.x-e.x)*(e.x-e.y)<0,1)}function a(t,e){var i,r,o=new egret.Point,s=0;r=n(t[0],e),s=r;for(var a=1;a<t.length;a++)i=n(t[a],e),r>i&&(r=i),i>s&&(s=i);return o.x=r,o.y=s,o}t.sat=e,t.dot=n,t.normalize=i,t.perp=r}(SAT_SIMPLE||(SAT_SIMPLE={}));var SAT;!function(t){function e(t,e,i,r,o,s){if(void 0===o&&(o=!1),void 0===s&&(s=!1),i.length<1||r.length<1)return!1;var a="Array"==i[0].constructor.name,h="Array"==r[0].constructor.name;if(!a&&!h)return n(t,e,i,r,o,s);var l=0,c=0;if(a&&h){for(l=0;l<i.length;l++)for(c=0;c<i.length;c++)if(n(t,e,i[l],r[c],o,s))return!0;return!1}if(a){for(l=0;l<i.length;l++)if(n(t,e,i[l],r,o,s))return!0;return!1}for(l=0;l<r.length;l++)if(n(t,e,i,r[l],o,s))return!0;return!1}function n(t,e,n,r,o,s){if(void 0===o&&(o=!1),void 0===s&&(s=!1),n.length<1||r.length<1)return!1;if(o&&s)return i(t,e,n,r);var a=[];if(o&&s){var g=new egret.Point(t.x-e.x,t.y-e.y);a.push(l(h(g)))}else o||(a=c(n,a)),s||(a=c(r,a));var y,d,v=new egret.Point;for(y=0;y<a.length;y++)if(d=o?f(t,n,a[y]):p(t,n,a[y]),v=s?f(e,r,a[y]):p(e,r,a[y]),!u(d,v))return!1;return!0}function i(t,e,n,i){if(2!=n.length||2!=i.length)return!1;var r=Math.pow(n[0].x+t.x-(i[0].x+e.x),2)+Math.pow(n[0].y+t.y-(i[0].y+e.y),2),o=Math.pow(n[1].x+i[1].x,2);return o>r}function r(t){if(t.length<1)return[0,0,0,0];for(var e=[t[0].x,t[0].y,t[0].x,t[0].y],n=0;n<t.length;n++)t[n].x<e[0]&&(e[0]=t[n].x),t[n].y<e[1]&&(e[1]=t[n].y),t[n].x>e[2]&&(e[2]=t[n].x),t[n].y>e[3]&&(e[3]=t[n].y);return e}function o(t){if(2!=t.length)return[0,0,0,0];var e=[t[0].x-t[1].x,t[0].y-t[1].x,t[0].x+t[1].x,t[0].y+t[1].x];return e}function s(t,e,n,i){return 4!=n.length||4!=i.length?!1:u(new egret.Point(n[0]+t.x,n[2]+t.x),new egret.Point(i[0]+e.x,i[2]+e.x))&&u(new egret.Point(n[1]+t.y,n[3]+t.y),new egret.Point(i[1]+e.y,i[3]+e.y))?!0:!1}function a(t,e){return t.x*e.x+t.y*e.y}function h(t){var e=new egret.Point(t.x,t.y),n=Math.sqrt(e.x*e.x+e.y*e.y);return n?(e.x=Math.round(100*e.x/n)/100,e.y=Math.round(100*e.y/n)/100,e):e}function l(t){var e=new egret.Point(t.x,t.y),n=e.x;return e.x=e.y,e.y=-n,e}function c(t,e){void 0===e&&(e=[]);var n,i=0,r=!1,o=new egret.Point,s=new egret.Point;for(n=0;n<t.length;n++){for(n>=t.length-1?(s.x=t[0].x-t[n].x,s.y=t[0].y-t[n].y):(s.x=t[n+1].x-t[n].x,s.y=t[n+1].y-t[n].y),o=l(h(s)),o.x<=0&&(0==o.x?o.y<0&&(o.y*=-1):(o.x*=-1,o.y*=-1)),r=!0,i=0;i<e.length;i++)if(e[i].x==o.x&&e[i].y==o.y){r=!1;break}r&&e.push(o)}return e}function u(t,e){return t.x>e.y?0:t.y<e.x?0:((t.x-e.x)*(e.x-e.y)<0,1)}function p(t,e,n){var i,r,o=new egret.Point,s=0;r=a(new egret.Point(e[0].x+t.x,e[0].y+t.y),n),s=r;for(var h=1;h<e.length;h++)i=a(new egret.Point(e[h].x+t.x,e[h].y+t.y),n),r>i&&(r=i),i>s&&(s=i);return o.x=r,o.y=s,o}function f(t,e,n){var i=new egret.Point;return i.x=a(new egret.Point(e[0].x+t.x,e[0].y+t.y),n)-e[1].x,i.y=i.x+2*e[1].x,i}t.sat=e,t.circleHit=i,t.getPolyBound=r,t.getCircleBound=o,t.boundHit=s,t.dot=a,t.normalize=h,t.perp=l}(SAT||(SAT={}));