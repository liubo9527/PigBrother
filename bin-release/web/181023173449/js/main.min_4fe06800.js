var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);o.prototype=e.prototype,t.prototype=new o},__awaiter=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function s(t){try{h(r.next(t))}catch(e){i(e)}}function a(t){try{h(r["throw"](t))}catch(e){i(e)}}function h(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(s,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return r([t,e])}}function r(o){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,i&&(s=i[2&o[0]?"return":o[0]?"throw":"next"])&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[0,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return h.label++,{value:o[1],done:!1};case 5:h.label++,i=o[1],o=[0];continue;case 7:o=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){h=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){h.label=o[1];break}if(6===o[0]&&h.label<s[1]){h.label=s[1],s=o;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(o);break}s[2]&&h.ops.pop(),h.trys.pop();continue}o=e.call(t,h)}catch(r){o=[6,r],i=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Game=function(t){function e(){var e=t.call(this)||this;return e.wofsArray=[],e.wofsPool=[],e.stonesPool=[],e.scoreCount=0,e.skinName="gameComponent",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gameInit()},e.prototype.gameInit=function(){for(var t=0;10>t;t++){var e=new Wof(0,this);this.wofsPool.push(e);var o=new Stone(RES.getRes("stone_png"));this.stonesPool.push(o)}this.pig=new Pig,this.pig.x=964,this.pig.y=77,this.pig.setGameControl(this),this.timer=new egret.Timer(2e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.createWof,this),this.timer.start()},e.prototype.createWof=function(t){var e;e=this.wofsPool.length>0?this.wofsPool.pop():new Wof(0,this),e.setInit(),this.wofsArray.push(e),this.collisionGroup.addChild(e)},e.prototype.updateString=function(){var t=this.pig.y-this.pigString.y;this.pigString.height=t+10},e.prototype.updateScore=function(){this.score.text="杀了"+this.scoreCount+"匹狼"},e.prototype.gameOVer=function(){this.scoreGroup.visible=!0},e}(eui.Component);__reflect(Game.prototype,"Game");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,o){function r(r){e.call(o,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),this.stage.removeChild(t),GameConst.stage=this.stage,e=new Game,this.stage.addChild(e),[3,5];case 4:return o=r.sent(),console.error(o),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,o){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,o,r){function n(t){e.call(r,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),o.call(r))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,o){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(o){window.JSONParseClass.setData(o),egret.callLater(function(){e.call(r,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var config={gameGroup:{}},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GameConst=function(){function t(){}return t}();__reflect(GameConst.prototype,"GameConst");var Pig=function(t){function e(){var e=t.call(this)||this;return e.arrowContainer=[],e.arrowBag=[],e.arrowSpeed=10,e.maxArrow=5,e}return __extends(e,t),e.prototype.setGameControl=function(t){this.gameControl=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="pig",this.init()},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this),egret.startTick(this.startTick,this);for(var t=0;5>t;){var e=new egret.Bitmap(RES.getRes("arrow_png"));this.parent&&(this.parent.addChild(e),e.x=this.x,e.scaleX=e.scaleY=.6,e.anchorOffsetY=e.height/2,e.y=this.y+130,this.arrowContainer.push(e)),t++}},e.prototype.touchMove=function(t){this.y=t.stageY-this.height/2,this.y>460?this.y=460:this.y<80&&(this.y=80),this.gameControl.updateString()},e.prototype.attack=function(){if(this.parent&&this.arrowBag.length>0){var t=this.arrowBag.pop();t.x=this.x,t.y=this.y+110,this.arrowContainer.push(t),this.parent.addChild(t)}},e.prototype.getArrows=function(){return this.arrowContainer},e.prototype.startTick=function(t){var e=this;return this.arrowContainer.forEach(function(t){var o=t;if(o.x-=e.arrowSpeed,o.x<-200){e.parent.removeChild(o);var r=e.arrowContainer.indexOf(o);e.arrowContainer.splice(r,1),e.arrowBag.push(o)}}),this.gameControl.wofsArray.forEach(function(t){e.hitWofTest(t)}),!1},e.prototype.hitWofTest=function(t){var e=this;this.arrowContainer.forEach(function(o){var r=o,n=t.ballute.hitTestPoint(r.x,r.y),i=t.fly.hitTestPoint(r.x,r.y);n&&t.beHited(),i&&e.hitWofBody(r)})},e.prototype.hitWofBody=function(t){var e=this,o=this.arrowContainer.indexOf(t);this.arrowContainer.splice(o,1),egret.Tween.get(t).to({rotation:-90},100).to({y:1e3,alpha:0},3e3).call(function(){t.alpha=1,t.rotation=0,e.arrowBag.push(t)})},e.prototype.beHited=function(){var t=this;egret.stopTick(this.startTick,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this),egret.Tween.get(this).to({y:550,alpha:1,rotation:30},1e3).call(function(){t.gameControl.gameOVer()})},e}(eui.Component);__reflect(Pig.prototype,"Pig");var Stone=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,o,r){this.posStart=t,this.posTemple=e,this.posEnd=o,this.gameControl=r},e.prototype["throw"]=function(){var t=this;egret.Tween.get(this).to({factor:2},3e3).call(function(){egret.Tween.removeTweens(t),t.parent.removeChild(t),egret.stopTick(t.start,t),t.gameControl.stonesPool.push(t)}),egret.startTick(this.start,this)},e.prototype.start=function(t){return this.gameControl.pig.hitTestPoint(this.x,this.y)&&this.gameControl.pig.beHited(),!1},e}(egret.Bitmap);__reflect(Stone.prototype,"Stone");var Wof=function(t){function e(e,o){var r=t.call(this)||this;return r.walkSpeed=120,r.flySpeed=60,r.beKilled=!1,r.skinName="wof",r.type=e,r.gameControl=o,r}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setWofState(0),this.x=-100,this.y=-60},e.prototype.setInit=function(){this.setWofState(0),this.x=-100,this.y=-60,this.alpha=1,this.beKilled=!1,this.autoMove()},e.prototype.setWofState=function(t){t!=this.stage&&(this.state=t,0==this.state?(this.walk.visible=!0,this.flyGroup.visible=!1):1==this.state&&(this.walk.visible=!1,this.flyGroup.visible=!0))},e.prototype.autoMove=function(){var t=this;egret.Tween.removeTweens(this);var e=Math.floor(600*Math.random())+128,o=1e3*e/this.walkSpeed,r=65e4/this.flySpeed,n=1e3*(1400-e)/this.walkSpeed;egret.Tween.get(this).to({x:e},o).call(function(){t.setWofState(1),t.throwStone(r)}).to({y:590},r).call(function(){t.setWofState(0)}).to({x:1400},n).call(function(){var e=t.gameControl.wofsArray.indexOf(t);t.gameControl.wofsArray.splice(e,1),t.parent&&(t.parent.removeChild(t),t.gameControl.wofsPool.push(t))})},e.prototype.beHited=function(){var t=this;egret.Tween.removeTweens(this),this.beKilled=!0,this.setWofState(0);var e=this.gameControl.wofsArray.indexOf(this);this.gameControl.wofsArray.splice(e,1),egret.Tween.get(this).to({y:1e3,alpha:0},3e3).call(function(){t.gameControl.wofsPool.push(t),t.parent.removeChild(t)}),this.gameControl.scoreCount++,this.gameControl.updateScore()},e.prototype.throwStone=function(t){var e=this,o=Math.random()*t;setTimeout(function(){if(!e.beKilled&&e.gameControl.stonesPool.length>0){e.stone=e.gameControl.stonesPool.pop();var t=new egret.Point(e.x,e.y+150),o=new egret.Point(e.gameControl.pig.x+85,e.gameControl.pig.y+85),r=(t.x+o.x)/2,n=(t.y+o.y)/2-100,i=new egret.Point(r,n);e.stone.setPos(t,i,o,e.gameControl),e.parent.addChild(e.stone),e.stone["throw"]()}},o)},e}(eui.Component);__reflect(Wof.prototype,"Wof");var PhysicsTool=function(){function t(){}return t.convertToPhysicsPos=function(t,e){return[t/this.factor,(egret.MainContext.instance.stage.stageHeight-e)/this.factor]},t.convertToPhysicsLength=function(t){return Math.floor(t/this.factor)},t.factor=50,t}();__reflect(PhysicsTool.prototype,"PhysicsTool");