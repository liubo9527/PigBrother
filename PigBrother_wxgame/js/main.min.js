var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{h(o.next(t))}catch(e){i(e)}}function a(t){try{h(o["throw"](t))}catch(e){i(e)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,i=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(o){n=[6,o],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Game=function(t){function e(){var e=t.call(this)||this;return e.wofsArray=[],e.wofsPool=[],e.stonesPool=[],e.scoreCount=0,e.skinName="gameComponent",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gameInit()},e.prototype.gameInit=function(){for(var t=0;10>t;t++){var e=new Wof(0,this);this.wofsPool.push(e);var n=new Stone(RES.getRes("stone_png"));this.stonesPool.push(n)}this.pig=new Pig,this.pig.x=964,this.pig.y=77,this.pig.setGameControl(this),this.addChild(this.pig),this.timer=new egret.Timer(2e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.createWof,this),this.timer.start()},e.prototype.createWof=function(t){var e;e=this.wofsPool.length>0?this.wofsPool.pop():new Wof(0,this),e.setInit(),this.wofsArray.push(e),this.collisionGroup.addChild(e)},e.prototype.updateString=function(){var t=this.pig.y-this.pigString.y;this.pigString.height=t+10},e.prototype.updateScore=function(){this.score.text="杀了"+this.scoreCount+"匹狼"},e.prototype.gameOVer=function(){this.scoreGroup.visible=!0},e}(eui.Component);__reflect(Game.prototype,"Game");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function o(o){e.call(n,o,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?o(r):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,this.loadTheme()];case 2:return o.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return o.sent(),this.stage.removeChild(t),GameConst.stage=this.stage,e=new Wellcome,this.stage.addChild(e),[3,5];case 4:return n=o.sent(),console.error(n),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,o){function r(t){e.call(o,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(o,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameData=function(){function t(){}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t}();__reflect(GameData.prototype,"GameData");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GameConst=function(){function t(){}return t.isWeiXin=function(){var t=navigator.userAgent.toString(),e=t.match(/MicroMessenger/i);return"MicroMessenger"==e?!0:!1},t}();__reflect(GameConst.prototype,"GameConst");var Pig=function(t){function e(){var e=t.call(this)||this;return e.arrowContainer=[],e.arrowBag=[],e.arrowSpeed=10,e.maxArrow=5,e}return __extends(e,t),e.prototype.setGameControl=function(t){this.gameControl=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="pig",this.init()},e.prototype.init=function(){GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this),egret.startTick(this.startTick,this);for(var t=0;5>t;){var e=new egret.Bitmap(RES.getRes("arrow_png"));this.parent&&(this.parent.addChild(e),e.x=this.x,e.scaleX=e.scaleY=.6,e.anchorOffsetY=e.height/2,e.y=this.y+130,this.arrowContainer.push(e)),t++}},e.prototype.touchMove=function(t){this.y=t.stageY-this.height/2,this.y>460?this.y=460:this.y<80&&(this.y=80),this.gameControl.updateString()},e.prototype.attack=function(){if(this.parent&&this.arrowBag.length>0){var t=this.arrowBag.pop();t.x=this.x,t.y=this.y+110,this.arrowContainer.push(t),this.parent.addChild(t)}},e.prototype.getArrows=function(){return this.arrowContainer},e.prototype.startTick=function(t){var e=this;return this.arrowContainer.forEach(function(t){var n=t;if(n.x-=e.arrowSpeed,n.x<-200){e.parent.removeChild(n);var o=e.arrowContainer.indexOf(n);e.arrowContainer.splice(o,1),e.arrowBag.push(n)}}),this.gameControl.wofsArray.forEach(function(t){e.hitWofTest(t)}),!1},e.prototype.hitWofTest=function(t){var e=this;this.arrowContainer.forEach(function(n){var o=n,r=t.ballute.hitTestPoint(o.x,o.y),i=t.fly.hitTestPoint(o.x,o.y);r&&t.beHited(),i&&e.hitWofBody(o)})},e.prototype.hitWofBody=function(t){var e=this,n=this.arrowContainer.indexOf(t);this.arrowContainer.splice(n,1),egret.Tween.get(t).to({rotation:-90},100).to({y:1e3,alpha:0},3e3).call(function(){t.alpha=1,t.rotation=0,e.arrowBag.push(t)})},e.prototype.beHited=function(){var t=this;egret.stopTick(this.startTick,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.attack,this),egret.Tween.get(this).to({y:550,alpha:1,rotation:30},1e3).call(function(){t.gameControl.gameOVer()})},e}(eui.Component);__reflect(Pig.prototype,"Pig");var Stone=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.posStart.x+2*t*(1-t)*this.posTemple.x+t*t*this.posEnd.x,this.y=(1-t)*(1-t)*this.posStart.y+2*t*(1-t)*this.posTemple.y+t*t*this.posEnd.y},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,n,o){this.posStart=t,this.posTemple=e,this.posEnd=n,this.gameControl=o},e.prototype["throw"]=function(){var t=this;egret.Tween.get(this).to({factor:2},3e3).call(function(){egret.Tween.removeTweens(t),t.parent.removeChild(t),egret.stopTick(t.start,t),t.gameControl.stonesPool.push(t)}),egret.startTick(this.start,this)},e.prototype.start=function(t){return this.gameControl.pig.hitTestPoint(this.x,this.y)&&this.gameControl.pig.beHited(),!1},e}(egret.Bitmap);__reflect(Stone.prototype,"Stone");var Wellcome=function(t){function e(){var e=t.call(this)||this;return e.login=!1,e.skinName="wellcome",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),GameConst.isWeiXin&&platform.login().then(function(t){if(console.log("ergert:res"+JSON.stringify(t)),"getUserInfo:ok"==t.errMsg){e.login=!0;var n={code:t.code,encryptedData:t.encryptedData,iv:t.iv,nickName:t.userInfo.nickName,gender:t.userInfo.gender,city:t.userInfo.city,province:t.userInfo.Promise,country:t.country,avatarUrl:t.userInfo.avatarUrl};GameData.getInstance().user=n,e.loadIM()}});var n=new Button;n.Init("start_png","",function(t){if(e.login){var n=new Game;e.parent.addChild(n),e.parent.removeChild(e)}},"start"),n.x=668,n.y=400,this.addChild(n)},e.prototype.loadIM=function(){var t=new egret.ImageLoader;t.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),t.load(GameData.getInstance().user.avatarUrl)},e.prototype.loadComplete=function(t){var e=new egret.Texture;e._setBitmapData(t.currentTarget.data);var n=new egret.Bitmap(e);this.addChild(n)},e}(eui.Component);__reflect(Wellcome.prototype,"Wellcome");var Wof=function(t){function e(e,n){var o=t.call(this)||this;return o.walkSpeed=120,o.flySpeed=60,o.beKilled=!1,o.skinName="wof",o.type=e,o.gameControl=n,o}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setWofState(0),this.x=-100,this.y=-60},e.prototype.setInit=function(){this.setWofState(0),this.x=-100,this.y=-60,this.alpha=1,this.beKilled=!1,this.autoMove()},e.prototype.setWofState=function(t){t!=this.stage&&(this.state=t,0==this.state?(this.walk.visible=!0,this.flyGroup.visible=!1):1==this.state&&(this.walk.visible=!1,this.flyGroup.visible=!0))},e.prototype.autoMove=function(){var t=this;egret.Tween.removeTweens(this);var e=Math.floor(600*Math.random())+128,n=1e3*e/this.walkSpeed,o=65e4/this.flySpeed,r=1e3*(1400-e)/this.walkSpeed;egret.Tween.get(this).to({x:e},n).call(function(){t.setWofState(1),t.throwStone(o)}).to({y:590},o).call(function(){t.setWofState(0)}).to({x:1400},r).call(function(){var e=t.gameControl.wofsArray.indexOf(t);t.gameControl.wofsArray.splice(e,1),t.parent&&(t.parent.removeChild(t),t.gameControl.wofsPool.push(t))})},e.prototype.beHited=function(){var t=this;egret.Tween.removeTweens(this),this.beKilled=!0,this.setWofState(0);var e=this.gameControl.wofsArray.indexOf(this);this.gameControl.wofsArray.splice(e,1),egret.Tween.get(this).to({y:1e3,alpha:0},3e3).call(function(){t.gameControl.wofsPool.push(t),t.parent.removeChild(t)}),this.gameControl.scoreCount++,this.gameControl.updateScore()},e.prototype.throwStone=function(t){var e=this,n=Math.random()*t;setTimeout(function(){if(!e.beKilled&&e.gameControl.stonesPool.length>0){e.stone=e.gameControl.stonesPool.pop();var t=new egret.Point(e.x,e.y+150),n=new egret.Point(e.gameControl.pig.x+85,e.gameControl.pig.y+85),o=(t.x+n.x)/2,r=(t.y+n.y)/2-100,i=new egret.Point(o,r);e.stone.setPos(t,i,n,e.gameControl),e.parent.addChild(e.stone),e.stone["throw"]()}},n)},e}(eui.Component);__reflect(Wof.prototype,"Wof");var Button=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.Init=function(t,e,n,o){this._callback=n,this._thisObj=o,this._bit=new egret.Bitmap(RES.getRes(t)),this._bit.scale9Grid=new egret.Rectangle(16,21,25,25),this.addChild(this._bit),this._bit.x=-this._bit.width/2,this._bit.y=-this._bit.height/2,this._txt=new egret.TextField,this._txt.text=e,this._txt.textColor=12189596,this._txt.x=-this._txt.textWidth/2,this._txt.y=-this._txt.textHeight/2,this.addChild(this._txt),this.touchChildren=!1,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onCancle,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this)},e.prototype.onTab=function(t){this._callback&&this._callback.call(this._thisObj)},e.prototype.onBegin=function(t){this.scaleX=this.scaleY=.9},e.prototype.onEnd=function(t){this.onCancle()},e.prototype.onCancle=function(t){void 0===t&&(t=null),this.scaleX=this.scaleY=1},e}(egret.Sprite);__reflect(Button.prototype,"Button"),window.Main=Main;